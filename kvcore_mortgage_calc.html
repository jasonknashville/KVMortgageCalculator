<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mortgage Calculator</title>
<style>
  :root{--radius:14px;--shadow:0 6px 28px rgba(0,0,0,.08);--gap:14px;--font: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;}
  *{box-sizing:border-box}
  body{margin:0; padding:18px; font-family:var(--font); background:#f7f7f8; color:#111}
  .wrap{max-width:980px; margin:0 auto}
  .card{background:white; border-radius:var(--radius); box-shadow:var(--shadow); padding:clamp(14px,2vw,22px)}
  .grid{display:grid; grid-template-columns:repeat(12,1fr); gap:var(--gap)}
  .col-6{grid-column:span 6}
  .col-12{grid-column:span 12}
  @media (max-width: 760px){ .col-6{grid-column:span 12} }
  label{font-size:.9rem; color:#333; display:block; margin-bottom:6px}
  input, select{width:100%; padding:12px 12px; border:1px solid #e6e6ea; border-radius:10px; font-size:1rem; background:#fff;}
  input:focus, select:focus{outline:none; border-color:#8b5cf6; box-shadow:0 0 0 3px rgba(139,92,246,.15)}
  .row{display:flex; gap:var(--gap); align-items:center}
  .suffix{white-space:nowrap; font-size:.95rem; color:#666}
  .stack{display:flex; flex-direction:column; gap:6px}
  .heading{display:flex; align-items:baseline; justify-content:space-between; margin:4px 0 14px}
  .heading h1{font-size:1.25rem; margin:0}
  .muted{color:#666; font-size:.95rem}
  .pill{display:inline-flex; align-items:center; gap:6px; padding:8px 12px; border-radius:999px; background:#f4f3ff; color:#4c1d95; font-weight:600; font-size:.95rem}
  .totals{display:grid; grid-template-columns:repeat(12,1fr); gap:var(--gap); margin-top:8px}
  .total-card{grid-column:span 6; background:#fafafa; border:1px solid #eee; border-radius:12px; padding:12px}
  @media (max-width: 760px){ .total-card{grid-column:span 12} }
  .total-card h2{margin:0 0 4px; font-size:1.1rem}
  .breakdown{display:grid; grid-template-columns:repeat(12,1fr); gap:8px; margin-top:6px}
  .chip{grid-column:span 6; display:flex; justify-content:space-between; background:#fff; border:1px solid #eee; border-radius:10px; padding:10px 12px; font-size:.96rem}
  @media (max-width: 760px){ .chip{grid-column:span 12} }
  .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
  button{border:0; border-radius:10px; padding:10px 14px; font-size:.95rem; cursor:pointer}
  .primary{background:#4f46e5; color:white}
  .ghost{background:#efeffe; color:#30237a}
  .foot{margin-top:14px; color:#666; font-size:.85rem}
  .small{font-size:.85rem; color:#555}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="heading">
      <h1>Mortgage Calculator</h1>
      <span class="pill" title="Embed anywhere via &lt;iframe&gt;">Free • Embeddable</span>
    </div>
    <div class="grid">
      <div class="col-6 stack">
        <label for="price">Home Price ($)</label>
        <input id="price" type="number" inputmode="decimal" value="425000" min="0" step="1000" />
      </div>
      <div class="col-6 stack">
        <label for="downPct">Down Payment (%)</label>
        <input id="downPct" type="number" inputmode="decimal" value="10" min="0" max="100" step="0.1" />
      </div>
      <div class="col-6 stack">
        <label for="rate">Interest Rate (APR %)</label>
        <input id="rate" type="number" inputmode="decimal" value="6.9" min="0" step="0.01" />
      </div>
      <div class="col-6 stack">
        <label for="term">Loan Term (years)</label>
        <select id="term">
          <option>30</option>
          <option>20</option>
          <option>15</option>
          <option>10</option>
        </select>
      </div>
      <div class="col-6 stack">
        <label for="taxPct">Property Tax (% of value / yr)</label>
        <input id="taxPct" type="number" inputmode="decimal" value="0.8" min="0" step="0.01" />
      </div>
      <div class="col-6 stack">
        <label for="insAnnual">Home Insurance (annual $)</label>
        <input id="insAnnual" type="number" inputmode="decimal" value="1400" min="0" step="50" />
      </div>
      <div class="col-6 stack">
        <label for="hoa">HOA (monthly $)</label>
        <input id="hoa" type="number" inputmode="decimal" value="0" min="0" step="5" />
      </div>
      <div class="col-6 stack">
        <label for="pmiPct">PMI (% of loan / yr, if LTV&gt;80%)</label>
        <input id="pmiPct" type="number" inputmode="decimal" value="0.5" min="0" step="0.05" />
      </div>
      <div class="col-12 actions">
        <button class="primary" id="calcBtn">Calculate</button>
        <button class="ghost" id="copyLink">Copy sharable link</button>
        <button class="ghost" id="copyEmbed">Copy &lt;iframe&gt; embed</button>
      </div>

      <div class="col-12 totals">
        <div class="total-card">
          <h2>Monthly Payment</h2>
          <div class="muted">All-in (P&I + taxes + insurance + PMI + HOA)</div>
          <div style="font-size:2rem; font-weight:800; margin-top:6px" id="monthly">$0</div>
        </div>
        <div class="total-card">
          <h2>Loan Details</h2>
          <div class="small" id="loanDetails">—</div>
        </div>
      </div>

      <div class="col-12">
        <div class="breakdown" id="breakdown">
          <!-- chips inserted here -->
        </div>
      </div>

      <div class="col-12 foot">
        Estimates only. Not a commitment to lend. Consult your lender for exact figures.
      </div>
    </div>
  </div>
</div>

<script>
function fmt(n){return n.toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:0})}
function chip(label, value){
  const div = document.createElement('div');
  div.className = 'chip';
  div.innerHTML = `<span>${label}</span><strong>${fmt(value)}</strong>`;
  return div;
}

// Calculate monthly mortgage payment (principal & interest) using standard amortization
function monthlyPI(loan, annualRatePct, years){
  const r = annualRatePct/100/12;
  const n = years*12;
  if(r === 0) return loan/n;
  return loan * (r*Math.pow(1+r,n)) / (Math.pow(1+r,n)-1);
}

function getInputs(){
  const price = parseFloat(document.getElementById('price').value || 0);
  const downPct = parseFloat(document.getElementById('downPct').value || 0);
  const rate = parseFloat(document.getElementById('rate').value || 0);
  const term = parseInt(document.getElementById('term').value || 30, 10);
  const taxPct = parseFloat(document.getElementById('taxPct').value || 0);
  const insAnnual = parseFloat(document.getElementById('insAnnual').value || 0);
  const hoa = parseFloat(document.getElementById('hoa').value || 0);
  const pmiPct = parseFloat(document.getElementById('pmiPct').value || 0);
  return {price, downPct, rate, term, taxPct, insAnnual, hoa, pmiPct};
}

function compute(){
  const {price, downPct, rate, term, taxPct, insAnnual, hoa, pmiPct} = getInputs();
  const down = price * (downPct/100);
  const loan = Math.max(price - down, 0);
  const ltv = loan / Math.max(price,1);

  const pi = monthlyPI(loan, rate, term);
  const taxes = (price * (taxPct/100)) / 12;
  const insurance = insAnnual / 12;
  const pmiMonthly = (ltv > 0.80 ? (loan * (pmiPct/100))/12 : 0);

  const monthlyAllIn = pi + taxes + insurance + pmiMonthly + hoa;

  // Update UI
  document.getElementById('monthly').textContent = fmt(monthlyAllIn);
  const bd = document.getElementById('breakdown');
  bd.innerHTML = '';
  bd.appendChild(chip('Principal & Interest', pi));
  bd.appendChild(chip('Property Taxes', taxes));
  bd.appendChild(chip('Home Insurance', insurance));
  if(pmiMonthly>0) bd.appendChild(chip('PMI (until 80% LTV)', pmiMonthly));
  if(hoa>0) bd.appendChild(chip('HOA', hoa));

  const loanDetails = document.getElementById('loanDetails');
  loanDetails.innerHTML = `
    Price: <strong>${fmt(price)}</strong> • Down: <strong>${downPct.toFixed(1)}%</strong> (${fmt(down)})<br>
    Loan: <strong>${fmt(loan)}</strong> • Rate: <strong>${rate.toFixed(2)}%</strong> • Term: <strong>${term} yrs</strong><br>
    LTV: <strong>${(ltv*100).toFixed(1)}%</strong>${ltv>0.80?' • PMI applies':''}
  `;
}

function paramsFromState(){
  const p = getInputs();
  const q = new URLSearchParams();
  Object.entries(p).forEach(([k,v]) => q.set(k, String(v)));
  return q.toString();
}

function applyStateFromParams(){
  const url = new URL(window.location.href);
  const q = url.searchParams;
  const ids = ['price','downPct','rate','term','taxPct','insAnnual','hoa','pmiPct'];
  let changed = false;
  ids.forEach(id => {
    if(q.has(id)){
      const el = document.getElementById(id);
      el.value = q.get(id);
      changed = true;
    }
  });
  if(changed) compute();
}

document.getElementById('calcBtn').addEventListener('click', compute);
['price','downPct','rate','term','taxPct','insAnnual','hoa','pmiPct'].forEach(id=>{
  document.getElementById(id).addEventListener('input', compute);
});

document.getElementById('copyLink').addEventListener('click', async () => {
  const base = location.href.split('?')[0];
  const link = base + '?' + paramsFromState();
  try{ await navigator.clipboard.writeText(link); alert('Sharable link copied!'); }catch(e){ prompt('Copy this link:', link); }
});

document.getElementById('copyEmbed').addEventListener('click', async () => {
  const base = location.href.split('?')[0];
  const src = base + '?' + paramsFromState();
  const code = `<iframe src="${src}" width="100%" height="560" style="border:0;max-width:980px" loading="lazy"></iframe>`;
  try{ await navigator.clipboard.writeText(code); alert('<iframe> embed code copied!'); }catch(e){ prompt('Copy this embed code:', code); }
});

// Init
applyStateFromParams();
compute();
</script>
</body>
</html>
